<!DOCTYPE HTML>
<html>

<head>
    <link type="text/css" rel="stylesheet" href="css/normalize.css" />
    <link type="text/css" rel="stylesheet" href="css/style.css" />
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    </style>
</head>

<body>
    <div class="wrapper">
        <h1>What Tech Giants Contribute to Open source?</h1>
        <h2>Compare the open source contributions of 5 tech giants over the last 5 years.</h2>
        <p>It might surprise you just how often large companies give away their code to the open source community. At that point, anyone can contribute, debug, or download the code from a repository on GitHub and then use it for themselves. Let us take a look at those open source projects initiated by these giant tech companies.</p>
        <h3>Filter Projects by Programming Language</h3>
        <nav id="filter">
            <li><a href="#">TBD</a></li>
            <li><a href="#">TBD</a></li>
            <li><a href="#">TBD</a></li>
            <li><a href="#">TBD</a></li>
            <li><a href="#">TBD</a></li>
            <li><a href="#">TBD</a></li>
            <li><a href="#">TBD</a></li>
            <li><a href="#">TBD</a></li>
            <li><a href="#">TBD</a></li>
        </nav>
        <div class="graph"></div>
    </div>
    <script type="text/javascript" src="data.json"></script>
    <script type="text/javascript">
    (function() {
        var langs = ['Javascript', 'Python', 'Ruby', 'Java', 'C/C++', 'PHP', 'Objective-C', 'Go', 'Others'];
        var colors = ['#D0021B', '#8AC2BD', '#DBAFC7', '#EAB669', '#FD94F6', '#C9C890', '#FEC542', '#7598F8', '#9E9790'];
        var color_map = (function() {
            var ret = {};
            for (var i = 0; i < langs.length; ++i) {
                ret[langs[i]] = colors[i];
            }
            return ret;
        })();

        var nav = document.getElementById("filter");
        var lis = document.getElementsByTagName("li");


        for (var i = 0; i < lis.length; ++i) {
            var a = lis[i].getElementsByTagName('a')[0];
            a.addEventListener('click', function(e) {
                alert("Filter is not ready, please wait...");
                e.preventDefault(); // so that disable default
                return false; // so that disable default in IE
            }, /*useCapture*/ false);
            a.innerHTML = langs[i];
            a.setAttribute('style', 'color:' + colors[i]);
        }

        var margin = {
                top: 50,
                right: 200,
                bottom: 20,
                left: 20
            },
            width = 900,
            height = 350;

        var start_year = 2010,
            end_year = 2015;

        var c = d3.scale.category20c();

        var x = d3.scale.linear()
            .range([0, width]);

        var xAxis = d3.svg.axis()
            .scale(x)
            .orient("top");

        var formatYears = d3.format("0000");
        xAxis.tickFormat(formatYears);

        var svg = d3.select(".graph").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .style("margin-left", margin.left + "px")
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");


        function process(data) {
            x.domain([start_year, end_year]);
            var xScale = d3.scale.linear()
                .domain([start_year, end_year])
                .range([0, width]);

            svg.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis);

            for (var j = 0; j < data.length; j++) {
                var g = svg.append("g").attr("class", "journal");

                var circles = g.selectAll("circle")
                    .data(data[j]['commits'])
                    .enter()
                    .append("circle");

                var text = g.selectAll("text")
                    .data(data[j]['commits'])
                    .enter()
                    .append("text");

                var rScale = d3.scale.linear()
                    .domain([0, 10])
                    .range([2, 9]);

                circles
                    .attr("cx", function(d, i) {
                        return xScale(d[0]);
                    })
                    .attr("cy", j * 70 + 20)
                    .attr("r", function(d) {
                        return rScale(10);
                    })
                    .style("fill", function(d) {
                        return color_map[d[1]];
                    });

                text
                    .attr("y", j * 70 + 25)
                    .attr("x", function(d, i) {
                        return xScale(d[0]) - 5;
                    })
                    .attr("class", "value")
                    .style("fill", function(d) {
                        return color_map[d[1]];
                    })
                    .style("display", "none");

                g.append("svg:image")
                    .attr("y", j * 70 + 10)
                    .attr("x", width + 50)
                    .attr('width', 60)
                    .attr('height', 30)
                    .attr("class", "label")
                    .attr("xlink:href", data[j]['name']);
            };

            /*function mouseover(p) {
                var g = d3.select(this).node().parentNode;
                d3.select(g).selectAll("circle").style("display", "none");
                d3.select(g).selectAll("text.value").style("display", "block");
            }

            function mouseout(p) {
                var g = d3.select(this).node().parentNode;
                d3.select(g).selectAll("circle").style("display", "block");
                d3.select(g).selectAll("text.value").style("display", "none");
            }*/
        }

        process(data);
    })();
    </script>
</body>

</html>
